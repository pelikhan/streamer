(this.webpackJsonpstreamer=this.webpackJsonpstreamer||[]).push([[0],{67:function(e,t,a){},89:function(e,t,a){e.exports=a(99)},95:function(e,t,a){},99:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(26),i=a.n(c),o=(a(67),a(23)),l=a.n(o),s=a(17),d=a(34);a(95);function u(e){var t=e.state,a=e.children;return r.a.createElement("div",{className:"".concat(t.scene,"scene ").concat(t.hardware?"hardware":""," ").concat(t.chat&&!t.hardware?"chat":""," ").concat(t.paint?"paint":""," ").concat(t.multi?"multi":"")},a)}function m(e){var t=e.children,a=e.id,n=e.hidden;return r.a.createElement("div",{id:a,className:"source ".concat(n?"hidden":"")},t)}var E=a(42),h=a(126);function f(){return T.apply(this,arguments)}function T(){return(T=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=(t=e.sent).filter((function(e){return"videoinput"===e.kind})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){try{if(e.srcObject){var t=e.srcObject.getVideoTracks();t&&t[0]&&t[0].stop&&t[0].stop()}e.srcObject=null}catch(a){}}function p(){return(p=Object(d.a)(l.a.mark((function e(t,a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(t),console.log("trying webcam ".concat(a)),n={audio:!1,video:{aspectRatio:4/3}},a&&(n.video.deviceId=a),e.next=6,navigator.mediaDevices.getUserMedia(n);case 6:r=e.sent,t.volume=0,t.srcObject=r,t.onloadedmetadata=function(e){console.log("start webcam ".concat(a)),t.play()};case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){var t=e.current,a=e.action,n=e.dispatch,c=Object(E.a)({promiseFn:f}),i=c.data,o=c.isPending,l=[{key:"",text:"Off"}];i&&i.forEach((function(e){return l.push({key:e.deviceId,text:e.label||"camera ".concat(e.deviceId)})}));return r.a.createElement(h.a,{className:o?"loading":"",options:l,onChange:function(e,t){n({type:a,deviceId:null===t||void 0===t?void 0:t.key})},selectedKey:t})}function w(e){var t=e.id,a=e.deviceId,c=e.rotate,i=Object(n.useState)(""),o=Object(s.a)(i,2),l=o[0],d=o[1],u=r.a.useRef(null);return Object(n.useEffect)((function(){var e=u.current;e&&(e.srcObject&&l===a||function(e,t){return p.apply(this,arguments)}(e,a).then((function(){d(a)})).catch((function(t){console.log("error: ".concat(t.message)),v(e)})))})),r.a.createElement(m,{id:t},r.a.createElement("video",{className:c?"rotate":"",ref:u}))}var g=a(73);function b(e){var t=e.state,a=e.dispatch;function n(e){var t=e.icon,a=e.title,n=e.active,c=e.handler,i=e.text;return r.a.createElement("button",{className:"".concat(n?"active":""),title:a,onClick:c},!!t&&r.a.createElement(g.a,{iconName:t}),i||"")}function c(e){return r.a.createElement(n,{icon:e.icon,title:e.title,text:e.emoji,active:"emoji"===t.paintTool&&e.emoji?e.emoji===t.emoji:e.tool===t.paintTool,handler:function(){return a({type:R.SET_PAINT_TOOL,tool:e.tool,emoji:e.emoji})}})}function i(e){var c=e.icon,i=e.title,o=e.scene;return r.a.createElement(n,{icon:c,title:i,active:t.scene===o,handler:function(){return a({type:R.SET_SCENE,scene:o})}})}if(t.paint){var o=[];if(t.emojis)for(var l=0;l<t.emojis.length;l+=2)o[l>>1]=t.emojis.substr(l,2);return r.a.createElement("div",{id:"toolbox"},r.a.createElement(c,{icon:"ArrowTallUpLeft",title:"Draw arrow",tool:"arrow"}),r.a.createElement(c,{icon:"RectangleShape",title:"Draw rectangle",tool:"rect"}),r.a.createElement(c,{icon:"PenWorkspace",title:"Draw freeform",tool:"pen"}),o.map((function(e){return r.a.createElement(c,{emoji:e,tool:"emoji",title:"Stamp "+e})})),r.a.createElement(n,{icon:"ChromeClose",title:"Edit Paint mode",handler:function(){return a({type:R.SET_PAINT,on:!1})}}))}return r.a.createElement("div",{id:"toolbox"},r.a.createElement(i,{icon:"OpenPane",title:"move webcam left",scene:"left"}),r.a.createElement(i,{icon:"OpenPaneMirrored",title:"move webcam right",scene:"right"}),r.a.createElement(i,{icon:"Contact",title:"webcam large",scene:"chat"}),t.hardwareCamId&&r.a.createElement(n,{icon:"Robot",title:"hardware webcam",handler:function(){return a({type:R.SET_HARDWARECAM,on:!t.hardware})},active:t.hardware}),(t.mixer||t.twitch)&&r.a.createElement(n,{icon:"OfficeChat",title:"show/hide chat",handler:function(){return a({type:R.SET_CHAT,on:!t.chat})},active:t.chat}),r.a.createElement(n,{icon:"PenWorkspace",title:"Paint mode",handler:function(){return a({type:R.SET_PAINT,on:!0})}}),r.a.createElement(n,{icon:"Settings",title:"show settings",handler:function(){return a({type:R.SET_SETTINGS,on:!0})}}))}var I=a(128),_=a(130),C=a(133);function x(e){var t,a=e.id,n=e.url,c=e.title,i=e.sandbox,o=e.hidden,l=e.dataKind;return t=i?r.a.createElement("iframe",{"data-kind":l,title:c,src:n,sandbox:"allow-scripts allow-same-origin"}):r.a.createElement("iframe",{"data-kind":l,title:c,src:n,allow:"usb;camera"}),r.a.createElement(m,{id:a,hidden:o},t)}function y(){var e=Object(E.b)("https://makecode.com/editors.json",{headers:{accept:"application/json"}});return{editorConfigs:e.data,error:e.error,isPending:e.isPending}}function A(e){var t=e.editor,a=e.dispatch,n=y().editorConfigs,c=[];if(n)for(var i in n)c.push({key:i,text:n[i].name});return r.a.createElement(h.a,{label:"Choose your editor",options:c,selectedKey:t,onChange:function(e,t){(null===t||void 0===t?void 0:t.key)&&a({type:R.SET_EDITOR,editor:null===t||void 0===t?void 0:t.key})}})}function k(e){var t=e.editor,a=e.id,n=e.multi,c=y(),i=c.editorConfigs,o=c.isPending;if(!i||o)return null;var l=i[t];if(!l)return null;var s="".concat(l.url,"?editorLayout=ide&nosandbox=1");return n&&(s+="&nestededitorsim=1"),r.a.createElement(x,{id:a,url:s,dataKind:"makecode"})}function O(e){var t=e.state,a=e.dispatch;return r.a.createElement(m,{id:"settings"},r.a.createElement(I.a,{id:"settingsclose",onClick:function(){return a({type:R.SET_SETTINGS,on:!1})}},"close"),r.a.createElement("h2",null,"MakeCode Streamer settings"),r.a.createElement(n,null,r.a.createElement(A,{editor:t.editor,dispatch:a})),r.a.createElement(n,null,r.a.createElement(o,{label:"Multi editors",checked:t.multi,action:R.SET_MULTI})),r.a.createElement("h2",null,"Video"),r.a.createElement(n,null,r.a.createElement(i,{text:"Face cameras"}),r.a.createElement(S,{current:t.faceCamId,action:R.SET_FACECAM_ID,dispatch:a})),r.a.createElement(n,null,r.a.createElement(i,{text:"Hardware camera"}),r.a.createElement(S,{current:t.hardwareCamId,action:R.SET_HARDWARECAM_ID,dispatch:a})),r.a.createElement("h2",null,"Paint"),r.a.createElement(n,null,r.a.createElement(c,{label:"Emojis (\ud83d\ude04\ud83e\udd14\ud83d\ude2d\ud83d\udc40)",placeholder:"Emojis",action:R.SET_EMOJIS,current:t.emojis})),r.a.createElement("h2",null,"Streaming chats"),r.a.createElement(n,null,r.a.createElement(c,{label:"Mixer",placeholder:"Mixer.com account (/account)",action:R.SET_MIXER,current:t.mixer})),r.a.createElement(n,null,r.a.createElement(c,{label:"Twitch",placeholder:"Twitch.tv account (/account)",action:R.SET_TWITCH,current:t.twitch})));function n(e){return r.a.createElement("div",{className:"field"},e.children)}function c(e){var t=e.label,n=e.placeholder,c=e.action,i=e.current;return r.a.createElement(_.a,{label:t,placeholder:n,onChange:function(e,t){return a({type:c,text:t})},value:i||""})}function i(e){return r.a.createElement("label",null,e.text)}function o(e){var t=e.label,n=e.checked,c=e.action;return r.a.createElement(C.a,{label:t,checked:n,onChange:function(){return a({type:c,on:!n})}})}}function j(e){var t=e.mixer,a=e.twitch,n=void 0;return t?n="https://mixer.com/embed/chat/".concat(t,"?composer=false"):a&&(n="https://www.twitch.tv/embed/".concat(a,"/chat?parent=").concat(window.location.host)),n?r.a.createElement(x,{id:"chat",sandbox:!0,url:n}):null}function M(e){var t,a,c,i,o=e.state,l=r.a.useRef(null),s=r.a.useRef(null),d={x:0,y:0},u={x:0,y:0};return Object(n.useEffect)((function(){return function(){if(t)return;l.current&&(t=l.current,c=t.getContext("2d"));s.current&&(a=s.current,i=a.getContext("2d"));(function(){function e(){var e=i;if(e.clearRect(0,0,a.width,a.height),e.save(),"arrow"===o.paintTool){var t=d,n=u,r=2*e.lineWidth,c=n.x-t.x,l=n.y-t.y,s=Math.sqrt(c*c+l*l);e.translate(n.x,n.y),e.rotate(Math.atan2(l,c)),e.beginPath(),e.moveTo(0,0),e.lineTo(-s,0),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(-r,-r),e.moveTo(0,0),e.lineTo(-r,r),e.stroke()}else if("rect"===o.paintTool)e.beginPath(),e.rect(u.x,u.y,d.x-u.x,d.y-u.y),e.stroke();else if("pen"===o.paintTool)e.lineTo(d.x,d.y),e.stroke();else if("emoji"===o.paintTool){var m=d,E=u,h=E.x-m.x,f=E.y-m.y,T=Math.max(64,.9*Math.sqrt(h*h+f*f)|0);e.translate(E.x,E.y),e.rotate(Math.atan2(f,h)-Math.PI/2),e.font="".concat(T,"px serif"),e.textAlign="center",e.fillText(o.emoji||"",0,0)}e.restore()}window.addEventListener("resize",m,!1),m(),a.addEventListener("mousemove",(function(e){d.x=e.pageX-this.offsetLeft,d.y=e.pageY-this.offsetTop}),!1),a.addEventListener("mousedown",(function(n){u.x=n.pageX-this.offsetLeft,u.y=n.pageY-this.offsetTop,i.lineWidth=Math.max(10,t.width/100|0),i.lineJoin="round",i.lineCap="round",i.strokeStyle="#ffe135","pen"===o.paintTool&&(i.beginPath(),i.moveTo(d.x,d.y)),a.addEventListener("mousemove",e,!1)}),!1),a.addEventListener("mouseup",(function(){c.drawImage(a,0,0),i.clearRect(0,0,a.width,a.height),a.removeEventListener("mousemove",e,!1)}),!1)})(),c.clearRect(0,0,t.width,t.height),i.clearRect(0,0,t.width,t.height)}()})),r.a.createElement(n.Fragment,null,r.a.createElement("canvas",{ref:l,id:"paint"}),r.a.createElement("canvas",{ref:s,id:"painttool"}));function m(){var e=t.getBoundingClientRect();t.width=e.width,t.height=e.height,a.width=e.width,a.height=e.height}}var R,N=a(77);function D(){return function(e,t){var a=Object(n.useState)((function(){try{var a=window.localStorage.getItem(e);return a?JSON.parse(a):t}catch(n){return t}})),r=Object(s.a)(a,2),c=r[0],i=r[1];return[c,function(t){try{var a=t instanceof Function?t(c):t;i(a),window.localStorage.setItem(e,JSON.stringify(a))}catch(n){console.log(n)}}]}("streamer.config",{editor:"microbit",scene:"left"})}function P(){return(P=Object(d.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("looking for web cam"),e.next=3,f();case 3:(a=e.sent)&&a[0]&&a[0].deviceId&&t({type:R.SET_FACECAM_ID,deviceId:a[0].deviceId});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(){var e=D(),t=Object(s.a)(e,2),a=t[0],c=t[1],i=Object(n.useReducer)((function(e,t){var a=function(e){return JSON.parse(JSON.stringify(e))}(e);switch(t.type){case R.SET_EDITOR:a.editor=t.editor;break;case R.SET_SCENE:a.scene=t.scene;break;case R.SET_FACECAM_ID:a.faceCamId=t.deviceId;break;case R.SET_HARDWARECAM_ID:a.hardwareCamId=t.deviceId;break;case R.SET_MULTI:a.multi=!!t.on;break;case R.SET_HARDWARECAM:a.hardware=!!t.on;break;case R.SET_SETTINGS:a.settings=!!t.on;break;case R.SET_MIXER:a.mixer=t.text;break;case R.SET_TWITCH:a.twitch=t.text;break;case R.SET_EMOJIS:a.emojis=t.text;break;case R.SET_CHAT:a.chat=t.on;break;case R.SET_PAINT:a.paint=t.on;break;case R.SET_PAINT_TOOL:var n=t;a.paintTool=n.tool,n.emoji&&(a.emoji=n.emoji)}return c(a),a}),a),o=Object(s.a)(i,2),l=o[0],d=o[1];return Object(n.useEffect)((function(){l.faceCamId||function(e){P.apply(this,arguments)}(d)})),r.a.createElement(u,{state:l},r.a.createElement(k,{id:"editor",editor:a.editor,multi:l.multi}),l.multi&&r.a.createElement(k,{id:"editor2",editor:a.editor,multi:l.multi}),r.a.createElement(j,{mixer:a.mixer,twitch:a.twitch}),r.a.createElement(w,{id:"facecam",deviceId:l.faceCamId}),l.hardwareCamId&&r.a.createElement(w,{id:"hardwarecam",deviceId:l.hardwareCamId}),l.paint&&r.a.createElement(M,{state:l}),r.a.createElement(m,{id:"social"},r.a.createElement(b,{state:l,dispatch:d}),r.a.createElement("div",{id:"banner"})),l.settings&&r.a.createElement(O,{state:l,dispatch:d}))}!function(e){e[e.SET_SCENE=0]="SET_SCENE",e[e.SET_FACECAM_ID=1]="SET_FACECAM_ID",e[e.SET_HARDWARECAM_ID=2]="SET_HARDWARECAM_ID",e[e.SET_HARDWARECAM=3]="SET_HARDWARECAM",e[e.SET_MULTI=4]="SET_MULTI",e[e.SET_SETTINGS=5]="SET_SETTINGS",e[e.SET_MIXER=6]="SET_MIXER",e[e.SET_TWITCH=7]="SET_TWITCH",e[e.SET_EMOJIS=8]="SET_EMOJIS",e[e.SET_EDITOR=9]="SET_EDITOR",e[e.SET_CHAT=10]="SET_CHAT",e[e.SET_PAINT=11]="SET_PAINT",e[e.SET_PAINT_TOOL=12]="SET_PAINT_TOOL"}(R||(R={})),Object(N.a)(),window.onmessage=function(e){var t=e.data,a=e.source;if(t.broadcast){t.outer=!0;for(var n=document.querySelectorAll("iframe[data-kind = makecode]"),r=0;r<n.length;++r){var c=n[r];c.contentWindow&&c.contentWindow!==a&&c.contentWindow.postMessage(t,"*")}}};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(W,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[89,1,2]]]);
//# sourceMappingURL=main.622fe27d.chunk.js.map